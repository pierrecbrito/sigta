<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Frameset//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-frameset.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:a="http://xmlns.jcp.org/jsf/passthrough" xmlns:f="http://xmlns.jcp.org/jsf/core">
	<h:head>
		<title>SIGTA</title>
		
		 <h:outputStylesheet library="css" name="base.css"  /> 
		 <h:outputStylesheet library="css" name="system.css"  /> 
		 <h:outputStylesheet library="css" name="dashboard.css"  /> 
		 
	</h:head>
	<h:body>
		
		<main id="container">
			<div id="content">
				<div class="container-direita">
					<h:form id="formUser">
						<a id="btn-addtarefa" class="btn" href="#ex1" rel="modal:open">Adicionar tarefa</a>
						<h:commandButton  id="btn-sair" value="Sair" action="#{tarefasManagedBean.logout}"/>
					</h:form>
					<div id="letra-usuario">
						<span id="letra"><h:outputText value="#{tarefasManagedBean.primeiraLetraNome}"/></span>
					</div>
				</div>
				
				<section class="card">
					<div id="status-tarefas">
						<div class="texto-mutado" id="barra-status">
							<h:outputText value="#{tarefasManagedBean.quantTarefasFinalizadas}"/>/<h:outputText value="#{tarefasManagedBean.quantTarefasTotal}"/>
							 (<h:outputText value="#{tarefasManagedBean.porcentagemTarefasFinalizadas}">
							 	<f:convertNumber type="number" groupingUsed="true" minFractionDigits="1" pattern="#0.0"/>
							 </h:outputText>%)
						</div>
						<div id="barra-progresso">
							<div id="progresso" style="width: #{tarefasManagedBean.porcentagemTarefasFinalizadas}%"></div>
						</div>
					</div>
					<div class="container-direita">
						<div id="filtros">
							<span id="filtro-expand" class="">Filtros</span>ðŸ”½
							<div id="filtro-expand-content">
							    <h:form id="formFiltro">
									<h:inputText id="titulo" value="#{tarefasManagedBean.tituloFiltro}" a:placeholder="TÃ­tulo"/>
									<h:inputText id="dataHora" a:type="datetime-local" value="#{tarefasManagedBean.dataHoraFiltro}" converter="localDateTimeConverter"  a:placeholder="AtÃ© dd/MM/yyyy HH:mm"/>
									<h:selectOneMenu id="prioridade" value="#{tarefasManagedBean.prioridadeFiltro}" >
									    <f:selectItem itemLabel="Selecione" itemValue="" />
									    <f:selectItems value="#{tarefasManagedBean.niveisPrioridade}" />
									  
									</h:selectOneMenu>
									<h:selectOneMenu id="status" value="#{tarefasManagedBean.statusFiltro}" >
									    <f:selectItem itemLabel="Selecione" itemValue="" />
									    <f:selectItems value="#{tarefasManagedBean.tiposStatus}" />
									</h:selectOneMenu>
									<h:inputTextarea value="#{tarefasManagedBean.descricaoFiltro}" a:placeholder="DescriÃ§Ã£o" rows="4"/>
									<h:commandButton value="Buscar" action="#{tarefasManagedBean.getTarefas}">
									</h:commandButton>
							    </h:form>
	                        </div>
						</div>
					</div>
					<h:dataTable value="#{tarefasManagedBean.tarefas}" var="tarefaLinha" id="tabelaTarefas">			
						<h:column>
							<f:facet name="header">TÃ­tulo</f:facet>
							<h:outputText value="#{tarefaLinha.titulo}" />
						</h:column>
						<h:column>
							<f:facet name="header">Data e hora</f:facet>
							<h:outputText value="#{tarefaLinha.dataFinal}">
								 <f:convertDateTime pattern="HH:mm'h' 'de' dd 'de' MMMM" locale="pt_BR"/>
							</h:outputText>
						</h:column>
						<h:column>
							<h:panelGroup rendered="#{tarefaLinha.prioridadeDescricao == 'Alta' &amp;&amp; tarefaLinha.statusDescricao == 'Executando'}">
						        <f:facet name="header">Prioridade</f:facet>ðŸ”¥
								<h:outputText value="#{tarefaLinha.prioridadeDescricao}" />
							</h:panelGroup>
							<h:panelGroup rendered="#{tarefaLinha.prioridadeDescricao != 'Alta' || tarefaLinha.statusDescricao != 'Executando'}">
						        <f:facet name="header">Prioridade</f:facet>
								<h:outputText value="#{tarefaLinha.prioridadeDescricao}" />
							</h:panelGroup>
						</h:column>
						<h:column>
							<f:facet name="header">Status</f:facet>
							<h:outputText value="#{tarefaLinha.statusDescricao}" />
						</h:column>
						
						<h:column>
							<f:facet name="header">-</f:facet>
							<div class="container-btn-acoes">
								<h:commandButton onclick="abrirModalDeEdicao()" id="btn-selecTarefa" value="â†—" action="#{tarefasManagedBean.selecionarTarefa(tarefaLinha)}">
	            					<f:ajax render="formTarefaAtualizar" />
								</h:commandButton>
								<h:panelGroup rendered="#{tarefaLinha.statusDescricao == 'Executando'}">
						        	<h:commandButton id="btn-concluirTarefa" value="âœ”" action="#{tarefasManagedBean.concluirTarefa(tarefaLinha)}">
							            	<f:ajax render="tabelaTarefas" />
									</h:commandButton>
							    </h:panelGroup>
							</div>
						</h:column>
						
					</h:dataTable>
				</section>
			</div>
		</main>
		<div id="ex1" class="modal">
		 	<h:form id="formTarefa">
				<h2>Cadastrar tarefa</h2>
				<p class="texto-mutado">Tarefa sÃ£o uma Ã³tima maneira de acompanhar seu desenvolvimento</p>
				<h:messages id="mensagens"/> 
				<h:inputText value="#{tarefasManagedBean.tarefa.titulo}" a:placeholder="TÃ­tulo" required="true" requiredMessage="Ã‰ necessÃ¡rio digitar o nome."/>
				<h:inputTextarea value="#{tarefasManagedBean.tarefa.descricao}" a:placeholder="DescriÃ§Ã£o" required="true" requiredMessage="Ã‰ necessÃ¡rio digitar a descriÃ§Ã£o" rows="4"/>
				<h:inputText a:type="datetime-local" id="dataHora" value="#{tarefasManagedBean.tarefa.dataHora}" converter="localDateTimeConverter"  a:placeholder="AtÃ© dd/MM/yyyy HH:mm"/>
				<h:selectOneMenu value="#{tarefasManagedBean.tarefa.prioridade}" >
				    <f:selectItems value="#{tarefasManagedBean.niveisPrioridade}" />
				</h:selectOneMenu>
				<h:commandButton value="Cadastrar" action="#{tarefasManagedBean.cadastrar}"/>
			</h:form>
		</div>
		<div id="modalEdicao" class="modal">
		 	<h:form id="formTarefaAtualizar">
				<h2>Editar tarefa</h2>
				<p class="texto-mutado">Tenha certeza dos dados que vocÃª coloca aqui.</p>
				<h:inputText value="#{tarefasManagedBean.tarefaEdit.titulo}" a:placeholder="TÃ­tulo" required="true" requiredMessage="Ã‰ necessÃ¡rio digitar o nome."/>
				<h:inputTextarea value="#{tarefasManagedBean.tarefaEdit.descricao}" a:placeholder="DescriÃ§Ã£o" required="true" requiredMessage="Ã‰ necessÃ¡rio digitar a descriÃ§Ã£o" rows="4"/>
				<h:inputText a:type="datetime-local" id="dataHoraEdicao" value="#{tarefasManagedBean.tarefaEdit.dataHora}" converter="localDateTimeConverter"  a:placeholder="AtÃ© dd/MM/yyyy HH:mm"/>
				<h:selectOneMenu value="#{tarefasManagedBean.tarefaEdit.prioridade}" >
				    <f:selectItems value="#{tarefasManagedBean.niveisPrioridade}" />
				</h:selectOneMenu>
				<h:selectOneMenu value="#{tarefasManagedBean.tarefaEdit.status}" >
				    <f:selectItems value="#{tarefasManagedBean.tiposStatus}" />
				</h:selectOneMenu>
				<h:commandButton value="Atualizar" action="#{tarefasManagedBean.atualizar}"/>
				<div class="btn-excluir" onclick="excluirEtapa1()">Excluir</div>
				<h:commandButton onclick="excluirEtapa2()" id="btn-excluir" value="Certeza? Clique aqui para confirmar." action="#{tarefasManagedBean.excluir}"/>
			</h:form>
		</div>
		
	</h:body>
	<!-- Remember to include jQuery :) -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script>
	<!-- jQuery Modal -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
	<script>
		  const excluirEtapa1 = () => {
			  $('.btn-excluir').hide();
			  $("input[id='formTarefaAtualizar:btn-excluir']").show();
		  }
		  
		  const excluirEtapa2 = () => {
			  $('.btn-excluir').show();
			  $("input[id='formTarefaAtualizar:btn-excluir']").hide();
		  }
		  
		  const abrirModalDeEdicao = () => {
			  $("#modalEdicao").modal("show");
		  }
		  
		  $("#filtro-expand").on("click", function(){
              $("#filtro-expand-content").animate({
            	    height: 'toggle'
              });
          });
	</script>
</html>