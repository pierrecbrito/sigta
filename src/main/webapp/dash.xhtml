<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Frameset//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-frameset.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:a="http://xmlns.jcp.org/jsf/passthrough" xmlns:f="http://xmlns.jcp.org/jsf/core">
	<h:head>
		<title>SIGTA</title>
		
		 <h:outputStylesheet library="css" name="base.css"  /> 
		 <h:outputStylesheet library="css" name="system.css"  /> 
		 <h:outputStylesheet library="css" name="dashboard.css"  /> 
		 
	</h:head>
	<h:body>
		
		<main id="container">
			<div id="content">
				<section class="card">
					<div class="container-direita">
						<a id="btn-addtarefa" class="btn" href="#ex1" rel="modal:open">Adicionar tarefa</a>
					</div>
					
					<h:dataTable value="#{tarefasManagedBean.tarefas}" var="tarefaLinha" id="tabelaTarefas">			
						<h:column>
							<f:facet name="header">Título</f:facet>
							<h:outputText value="#{tarefaLinha.titulo}" />
						</h:column>
						<h:column>
							<f:facet name="header">Descrição</f:facet>
							<h:outputText value="#{tarefaLinha.descricao}" />
						</h:column>
						<h:column>
							<f:facet name="header">Data e hora</f:facet>
							<h:outputText value="#{tarefaLinha.dataHora.hour}:#{tarefaLinha.dataHora.minute}h" />
							<h:outputText value=" de #{tarefaLinha.dataHora.dayOfMonth}/#{tarefaLinha.dataHora.monthValue}" />
						</h:column>
						<h:column>
							<f:facet name="header">Prioridade</f:facet>
							<h:outputText value="#{tarefaLinha.prioridade}" />
						</h:column>
						<h:column>
							<f:facet name="header">Status</f:facet>
							<h:outputText value="#{tarefaLinha.status}" />
						</h:column>
						
						<h:column>
							<f:facet name="header">-</f:facet>
							<div class="container-btn-acoes">
								<h:commandButton onclick="abrirModalDeEdicao()" id="btn-selecTarefa" value="↗" action="#{tarefasManagedBean.selecionarTarefa(tarefaLinha)}">
	            					<f:ajax render="formTarefaAtualizar" />
								</h:commandButton>
								<h:panelGroup rendered="#{tarefaLinha.status.name() == 'EXECUTANDO'}">
						        	<h:commandButton id="btn-concluirTarefa" value="✅" action="#{tarefasManagedBean.concluirTarefa(tarefaLinha)}">
							            	<f:ajax render="tabelaTarefas" />
									</h:commandButton>
							    </h:panelGroup>
							</div>
						</h:column>
						
					</h:dataTable>
				</section>
			</div>
		</main>
		<div id="ex1" class="modal">
		 	<h:form id="formTarefa">
				<h2>Cadastrar tarefa</h2>
				<p class="texto-mutado">Tarefa são uma ótima maneira de acompanhar seu desenvolvimento</p>
				<h:messages id="mensagens"/> 
				<h:inputText value="#{tarefasManagedBean.tarefa.titulo}" a:placeholder="Título" required="true" requiredMessage="É necessário digitar o nome."/>
				<h:inputTextarea value="#{tarefasManagedBean.tarefa.descricao}" a:placeholder="Descrição" required="true" requiredMessage="É necessário digitar a descrição" rows="4"/>
				<h:inputText a:type="datetime-local" id="dataHora" value="#{tarefasManagedBean.tarefa.dataHora}" converter="localDateTimeConverter"  a:placeholder="Até dd/MM/yyyy HH:mm"/>
				<h:selectOneMenu value="#{tarefasManagedBean.tarefa.prioridade}" >
				    <f:selectItems value="#{tarefasManagedBean.niveisPrioridade}" />
				</h:selectOneMenu>
				<h:commandButton value="Cadastrar" action="#{tarefasManagedBean.cadastrar}"/>
			</h:form>
		</div>
		<div id="modalEdicao" class="modal">
		 	<h:form id="formTarefaAtualizar">
				<h2>Editar tarefa</h2>
				<p class="texto-mutado">Tenha certeza dos dados que você coloca aqui.</p>
				<h:inputText value="#{tarefasManagedBean.tarefa.titulo}" a:placeholder="Título" required="true" requiredMessage="É necessário digitar o nome."/>
				<h:inputTextarea value="#{tarefasManagedBean.tarefa.descricao}" a:placeholder="Descrição" required="true" requiredMessage="É necessário digitar a descrição" rows="4"/>
				<h:inputText a:type="datetime-local" id="dataHoraEdicao" value="#{tarefasManagedBean.tarefa.dataHora}" converter="localDateTimeConverter"  a:placeholder="Até dd/MM/yyyy HH:mm"/>
				<h:selectOneMenu value="#{tarefasManagedBean.tarefa.prioridade}" >
				    <f:selectItems value="#{tarefasManagedBean.niveisPrioridade}" />
				</h:selectOneMenu>
				<h:selectOneMenu value="#{tarefasManagedBean.tarefa.status}" >
				    <f:selectItems value="#{tarefasManagedBean.tiposStatus}" />
				</h:selectOneMenu>
				<h:commandButton value="Atualizar" action="#{tarefasManagedBean.atualizar}"/>
				<div class="btn-excluir" onclick="excluirEtapa1()">Excluir</div>
				<h:commandButton onclick="excluirEtapa2()" id="btn-excluir" value="Certeza? Clique aqui para confirmar." action="#{tarefasManagedBean.excluir}"/>
			</h:form>
		</div>
		
	</h:body>
	<!-- Remember to include jQuery :) -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script>
	<!-- jQuery Modal -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
	<script>
		  const excluirEtapa1 = () => {
			  $('.btn-excluir').hide();
			  $("input[id='formTarefaAtualizar:btn-excluir']").show();
		  }
		  
		  const excluirEtapa2 = () => {
			  $('.btn-excluir').show();
			  $("input[id='formTarefaAtualizar:btn-excluir']").hide();
		  }
		  
		  const abrirModalDeEdicao = () => {
			  $("#modalEdicao").modal("show");
		  }
	</script>
</html>